<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>Flask-SocketIO Chatroom</title>
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; }
    #chat-box { border: 1px solid #ccc; height: 300px; overflow-y: auto; padding: 5px; }
    #chat-input { width: 80%; padding: 5px; }
    #send-btn { width: 18%; padding: 5px; }
  </style>
</head>
<body>
  <h2>Flask-SocketIO Chatroom</h2>
  <div id="chat-box"></div>
  <input type="text" id="chat-input" placeholder="輸入訊息..." />
  <button id="send-btn">送出</button>

  <script>
    // 連線到後端
    const socket = io("http://localhost:5000");
    const chatBox = document.getElementById("chat-box");
    const chatInput = document.getElementById("chat-input");
    const sendBtn = document.getElementById("send-btn");

    // 工具函式：把訊息顯示在畫面上
    function addMessage(text, from="系統") {
      const msg = document.createElement("div");
      msg.textContent = from + ": " + text;
      chatBox.appendChild(msg);
      chatBox.scrollTop = chatBox.scrollHeight; // 自動捲到最底
    }

    // 連線成功
    socket.on("connect", () => {
      addMessage("已連線到伺服器 (id: " + socket.id + ")");
    });

    // 收到 server 廣播的 message
    socket.on("message", (data) => {
      addMessage(data.msg, "伺服器");
    });

    // 收到 server 廣播的 chat
    socket.on("chat", (data) => {
      addMessage(data.msg, "伺服器");
    });

    // 按下送出按鈕 → 發送 chat 訊息
    sendBtn.onclick = () => {
      const text = chatInput.value;
      if (text.trim() !== "") {
        socket.emit("chat", text);   // 發送到後端 @socketio.on('chat')
        addMessage(text, "你");      // 自己先顯示
        chatInput.value = "";
      }
    };

    // Enter 鍵也能送出
    chatInput.addEventListener("keypress", (e) => {
      if (e.key === "Enter") sendBtn.click();
    });
  </script>
</body>
</html>
